[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "“It’s Too Nice Out to Take a Cab”: Weather and Taxi Usage in New York, 2019–2024",
    "section": "",
    "text": "1 Introduction\nAt first, Moacir was interested in seeing if there is a relationship between “unseasonably” warm weather and New York and drought like conditions, but Sophie suggested crossing in a dataset from a different domain and seeing what kinds of results could emerge. Instead of just looking at the weather, perhaps we can draw a relationship between human behavioral response to the weather and taxi usage. What might this look like? After a bit of discussion, we had a preliminary idea of testing the hypothesis that people use cabs less often when it is “nice” out in Manhattan. That is, they are more inclined to walk to their destination than hail an expensive cab.\nQuickly it was clear, however, that proving this hypothesis would require coming up with a definition of “nice,” so we flipped the project: we’re assuming as true that people are more inclined to walk when the weather is nice, so we are using the taxi data to see if we can define what “nice” weather is. Does it just mean sunny skies, or does it have a relationship to a temperature threshold? How might relative temperature come into play, such as an unusually warm day after a cold spell, impacting people’s inclination to walk? And does the effect wear off if there are multiple nice days in a row, as the novelty of walking gives way to taking cabs again? These questions struck us as more amusing and speculative, so we decided to pursue them, instead.\nOverall, our project explores how weather influences the small, everyday decisions which collectively shape urban life. The unique spatial and temporal granularity of taxi data allows us to capture patterns of human mobility with precision. By doing so, we may observe behavioral shifts in response to weather changes in real time. Such a study not only provides a unique lens into how people adapt their transportation preferences due to the weather, but also serves as a microcosm for understanding human responses to environmental factors. Such insights are particularly relevant in a large, dynamic city like New York.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#a-glance-at-the-data",
    "href": "index.html#a-glance-at-the-data",
    "title": "“It’s Too Nice Out to Take a Cab”: Weather and Taxi Usage in New York, 2019–2024",
    "section": "1.1 A glance at the data",
    "text": "1.1 A glance at the data\nLet’s take a quick peek at the data. Below we have weekly averages for daily temperature and taxi rides from January 2019 to June 2024.\n\n\nCode\nlibrary(ggplot2)\nlibrary(arrow)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(tidyr)\ndf &lt;- read_parquet(\"data/complete_weather_and_taxi_data.parquet\")\ndf_day &lt;- df |&gt; \n    group_by(date) |&gt; \n    summarize(total_trips_day = sum(trip_count)) |&gt; \n    select(date, total_trips_day)\ndf_day |&gt; \n    mutate(week_start=lubridate::floor_date(date, unit=\"week\")) |&gt;\n    group_by(week_start) |&gt;\n    summarize(avg_trips_day = mean(total_trips_day))|&gt;\n    ggplot(aes(x=week_start, y=avg_trips_day)) +\n        geom_point(color=\"cornflowerblue\") +\n        geom_line(color=\"cornflowerblue\") + \n        scale_x_date(date_labels = \"%b %Y\", date_breaks = \"1 year\") +\n        scale_y_continuous(labels = comma) +\n        labs(title=\"Average daily taxi trips per week, January 2019 – June 2024\",\n             x = \"Date\", \n             y = \"Average number of trips in a day\") +\n        theme_classic()\n\n\n\n\n\n\n\n\n\nConsidering the taxi data, there are many narratives that can be told. The most notable observation on the chart is the dramatic decline in ridership in March 2020, coinciding with the beginning of the COVID-19 pandemic. While ridership has increased since, it has not nearly returned to pre-pandemic levels. This trend is likely influenced by the shift towards a more work-from-home friendly economic environment, along with other behavioral changes.\nWe can also observe seasonal fluctuations; for example, it appears that there are dips and peaks around January of each year. These could be attributed to behavioral changes around the holidays, including increased travel around the holidays, staying in on the holidays themselves, or different travel patterns due to the weather. We will have to look at this with a lot more granularity in order to parse out further trends in the data.\n\n\nCode\ndf_day &lt;- df |&gt; \n    filter(!is.na(temperature)) |&gt;\n    group_by(date) |&gt; \n    summarize(daily_temp = mean(temperature)) |&gt; \n    select(date, daily_temp)\ndf_day |&gt; \n    mutate(week_start=lubridate::floor_date(date, unit=\"week\")) |&gt;\n    group_by(week_start) |&gt;\n    summarize(avg_temp_day = mean(daily_temp)) |&gt;\n    ggplot(aes(x=week_start, y=avg_temp_day)) +\n        geom_point(color=\"cornflowerblue\") +\n        geom_line(color=\"cornflowerblue\") + \n        geom_hline(yintercept=0)+\n        scale_x_date(date_labels = \"%b %Y\", date_breaks = \"1 year\") +\n        labs(title=\"Average weekly temp, January 2019 – June 2024\",\n             x = \"Date\", \n             y = \"Tempurature (Celsius)\") +\n        theme_classic()\n\n\n\n\n\n\n\n\n\nAverage weekly temperature looks fairly consistent over time, with expected seasonal peaks and valleys across the year. There may be a subtle trend of slightly higher average temperatures in more recent years, but nothing too definitive.\nAs just one data point, temperature provides a limited slice into what may distinguish a “nice day.” In the next chapter, we will see that it will be necessary to calculate additional numeric and categorical weather measurements to help establish this definition. Ideas include change in temperature and a simple categorical variable for cloud cover derived from the multiple columns currently devoted to cloud cover.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "data.html",
    "href": "data.html",
    "title": "2  Data",
    "section": "",
    "text": "2.1 Description\nWe are basing our analysis on two datasets, a dataset of taxi use in New York and historical weather data. For both datasets, we initally planned to limit our analysis to 2019-02-01 00:00:00 – 2024-06-25 23:00:00, in the interest of trying to catch about a year of pre-pandemic norms to help interpret pandemic and post-pandemic use of taxis. As noted in the next chapter, we had to abandon this scope. The inital upper bound reflects the extent of the weather data, and we initially planned on going back to January of 2019. However, no high-volume for-hire vehicle (FHVHV) data are available for January, so we bumped our limit to February, 2019.\nThe taxi data are provided by New York’s Taxi and Limousine Commission. They provide taxi data, in parquet format, going back to 2009. Since February of 2019, they have also included data on trips serviced by companies like Lyft and Uber, which are classified as “high-volume for-hire vehicle” trips. The data are updated monthly, with a two-month lag. Our focus is on yellow taxi and FHVHV trips, because our focus is on intra-Manhattan trips. Only yellow cabs can pick up passengers in most of Manhattan, so we are ignoring green cabs and regular for-hire vehicles (town cars and limousines). Yellow cab data have 19 columns, and FHVHV data have 24 columns. With our Python scripts, we consolidate the data to create aggregated hourly statistics on trip duration and trip distance. We found the transaction data (fare amount and tip amount) noisy with unreliable outliers. It also fell outside of our scope of analysis. We also included time-delta statistics comparing a point in time with the same point in time a week earlier. We did this because taxi data follow weekly patterns.\nThe historical weather data are provided by the Global Historical Climate Network hourly (GHCNh), which provides hourly weather data going back over two centuries for New York City. The data come in annual parquet files for download by station. Our station, KNYC0, is listed in the GHCNh as USW00094728, and it is the weather station in Central Park. The data come in over 200 columns to account for the variability that can occur in the terse METAR report for airplanes, which is also included under remarks. The government provides a codebook to describe the remaining data. As we are interested in what conditions determine a “nice” day for not using a taxi, we aimed to keep a wide array of data, including temperature, precipitation, wind, sky cover, humidity, and so on. We badly wanted to include snow data, but snow has been so infrequent during this window that we folded the snow numbers into the general precipitation numbers.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#missing-value-analysis",
    "href": "data.html#missing-value-analysis",
    "title": "2  Data",
    "section": "2.2 Missing value analysis",
    "text": "2.2 Missing value analysis\nThe taxi data are notoriously (as in, persistently) messy, registering trips outside the bounds of the time window and giving results that seem extremely unlikely, like large negative tips or negative trip durations. To counter these anomalies, we are limiting ourselves to trips between one minute and two hours long as well as trips of ten or fewer miles. Similarly, and, when consolidating monthly data to yearly data, we filter out all results from other years. In the aggregate, however, the outliers generally wash out, as we have a record of over 500 million yellow cab and Uber/Lyft rides. Nevertheless, there is one data point where no trips are recorded: 2:00am on March 10, 2019. However, there are data on both sides, so we will interpolate results for this time. Who knows what happened to the taxi system that affected both Uber and yellow taxis. Additionally, the tip amounts for Uber/Lyft are almost certainly incorrect, as over 75% of rides report no tip at all. As such, we will drop the tip and fare amounts from our data to account for this. We had suspected that a higher tip percentage might be related to a nice day, even though we assume taxi usage is lower, but the data are simply unreliable.\nFor weather, we have a large array of missing values, but the remarks column is missing only 36 entries, for a general station uptime of 99.93%. Many of the columns have many more missing values, but that is because the way the weather data work is by reporting a NaN for the absence of data. That said, we have a consecutive period of 24 hours’ worth of missing data across May 31, 2023 to June 1, 2023. This includes missing remarks, suggesting the station was down. In our imagination, a peregrine falcon ate the station.\nThe other 12 missing remarks are scattered across the dataset.\nBecause we have a total of 47,328 points in time in our dataset, it is hard to see any of the missing data in any plot that includes the entire stretch.\n\n\nCode\nlibrary(ggplot2)\nlibrary(arrow)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(tidyr)\ndf &lt;- read_parquet(\"data/complete_weather_and_taxi_data.parquet\")\n\nheatmap_data &lt;- df |&gt;\n    mutate(week_start=lubridate::floor_date(date, unit=\"week\"),\n        week = lubridate::week(date),\n        year = lubridate::year(date)) |&gt;\n    group_by(year, week) |&gt;\n    summarize(n_missing=sum(is.na(temperature)))\n\nggplot(heatmap_data, aes(x = week, y = year, fill = n_missing)) +\n  geom_tile(color = \"white\") +\n  scale_fill_gradient(low = \"white\", high = \"red\", name = \"Missing Count\") +\n  scale_x_continuous(breaks = seq(1, 52, by = 4)) + \n  scale_y_continuous(breaks = seq(2019, 2024, by=1))+\n  labs(\n    title = \"Number of Missing Temperature Observations by Date\",\n    x = \"Week of Year\",\n    y = \"Year\"\n  ) +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n\n\n\n\n\n\n\n\nAs we can see in this chart, the missing temperature data (our most important metric, we suspect) are mostly centered in that 24-hour period when the station recorded no data. The other gaps are scattered across the data, with a tilt toward the older data. This is why we are confident in simply interpolating data for the missing values. Another option is to derive the temperature from the point in time’s METAR report, but we suspect the METAR reports for the missing data may be unparseable, in general.\n\n\nCode\nlibrary(redav)\ndf |&gt;\n  select(-c(juno, via)) |&gt;\n  plot_missing(percent=FALSE, max_rows=10, max_cols=10, num_char=6)\n\n\n\n\n\n\n\n\n\nOur second chart shows the distribution of missing data, from which we can see how infrequently a wind speed is registered and that the rest of the missing data are scattered in small numbers around the dataset, with almost all of the data making up complete cases (minus the above extracted columns).",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "results.html",
    "href": "results.html",
    "title": "3  Results",
    "section": "",
    "text": "3.1 Dealing with the Pandemic\nOur intial plan was to contain data from 2019 to get a sense of a pre-COVID-19 Pandemic baseline against which we could compare our post-Pandemic data.\nCode\ncustom_label &lt;- function(x) {\n  ifelse(x == 0, \"0\", label_comma(scale = 1e-6, suffix = \"M\")(x))\n}\n\ndf |&gt;\n  mutate(year_month = lubridate::ymd(paste(year, month, \"01\", sep = \"-\"))) |&gt;\n  pivot_longer(cols=c(\n    \"juno\", \"lyft\", \"uber\", \"via\", \"yellow\"\n    ), names_to=\"car_company\", values_to=\"car_company_trips\")  |&gt;\n  mutate(car_company = factor(car_company, levels = c(\"juno\", \"via\", \"lyft\", \"uber\", \"yellow\"))) |&gt;\n  group_by(year_month, car_company) |&gt;\n  summarize(trips_per_month = sum(car_company_trips), .groups = \"drop\") |&gt;\n  ggplot(aes(\n    x=year_month, \n    y=trips_per_month, \n    fill=car_company\n    )) +\n    geom_bar(stat = \"identity\", position = \"stack\") +\n      labs(\n    title = \"Trips per Month by Hired Car Company/Type\",\n    x = \"Month\",\n    y = \"Total Trips\",\n    fill = \"Hired Car Company/Type\"\n  ) +\n  scale_fill_brewer(\n    palette = \"Set2\",\n    labels = c(\n      \"yellow\" = \"Yellow Cab\",\n      \"juno\" = \"Juno\",\n      \"lyft\" = \"Lyft\",\n      \"via\" = \"Via\",\n      \"uber\" = \"Uber\"\n      )\n  ) +\n  scale_x_date(date_labels = \"%b %Y\", date_breaks = \"3 months\") +\n  scale_y_continuous(labels = custom_label) + \n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\n        legend.position = \"bottom\")\nThree details jump out from an initial look at managing the Pandemic. First, we can see when the Pandemic hit in March, 2020, but we can see that the ridership was already falling in February, even before large-scale shutdowns occurred. Next, we can see that two of the FHVHV companies, though only holding small portions of the market, disappeared from the picture. Juno shut down operations in November 2019, with drivers being offered to join Lyft.[1] Via also stopped its ride-sharing operations in December 2021.[2] The cessation of rides from these two companies only lead us toward the most striking aspect of hired car and taxi usage in Manhattan. Not only did usage fall during the pandemic, but we seem to be in a new normal, averaging about 7.5 million rides a month across yellow cabs, Lyft, and Uber. These numbers have held since October 2021, suggesting it may make sense to abandon all data from before this time, to get a good rhythm of usage.\nCode\nfirst_color &lt;- brewer.pal(8, \"Set2\")[1]\n\ndf |&gt;\n  mutate(year_month = as.Date(format(date, \"%Y-%m-01\"))) |&gt;\n  group_by(year_month) |&gt;\n  summarize(\n    monthly_trips = sum(trip_count),\n    monthly_half_mile = sum(half_mile_trips),\n    monthly_one_mile = sum(one_mile_trips),\n    monthly_two_mile = sum(two_mile_trips),\n    monthly_three_mile = sum(three_mile_trips),\n    monthly_five_mile = sum(five_mile_trips),\n    monthly_more_than_five = monthly_trips - monthly_half_mile - monthly_one_mile - monthly_two_mile - monthly_three_mile - monthly_five_mile,\n    pct_half_mile = monthly_half_mile / monthly_trips,\n    pct_one_mile = monthly_one_mile / monthly_trips,\n    pct_two_mile = monthly_two_mile / monthly_trips,\n    pct_three_mile = monthly_three_mile / monthly_trips,\n    pct_five_mile = monthly_five_mile / monthly_trips,\n    pct_more_than_five = monthly_more_than_five / monthly_trips,\n    .groups = \"drop\"\n  ) |&gt;\n  pivot_longer(\n    cols = c(\n    \"pct_half_mile\",\n    \"pct_one_mile\",\n    \"pct_two_mile\",\n    \"pct_three_mile\",\n    \"pct_five_mile\",\n    \"pct_more_than_five\",\n    ),\n    names_to = \"pct_trip_distance_group\",\n    values_to = \"pct_trip_distance_count\"\n  ) |&gt;\n  mutate(pct_trip_distance_group = factor(\n    pct_trip_distance_group, levels = c(\n      \"pct_more_than_five\",\n      \"pct_five_mile\",\n      \"pct_three_mile\",\n      \"pct_two_mile\",\n      \"pct_one_mile\",\n      \"pct_half_mile\"\n    ))) |&gt;\n  ggplot(aes(\n    x=year_month,\n    y= pct_trip_distance_count,\n    fill = pct_trip_distance_group\n    )) +\n    geom_bar(stat=\"identity\", position=\"stack\") +\n    labs(\n      title = \"Distribution of Taxi and Uber/Lyft Trip Distances under Ten Miles in Manhattan\",\n      x = \"Month\",\n      y = \"Percentage of Trips\",\n      fill = \"Trip Distance\"\n  ) +\n  scale_x_date(date_labels = \"%b %Y\", date_breaks = \"3 months\") +\n  scale_fill_brewer(\n    palette = \"Set2\",\n    labels = c(\n      \"pct_more_than_five\" = \"Five to Ten Miles\",\n      \"pct_five_mile\" = \"Three to Five Miles\",\n      \"pct_three_mile\" = \"Two to Three Miles\",\n      \"pct_two_mile\" = \"One to Two Miles\",\n      \"pct_one_mile\" = \"Half Mile to One Miles\",\n      \"pct_half_mile\" = \"Under Half a Mile\"\n    )\n  ) +\n  scale_y_continuous(labels = label_percent()) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\n        legend.position = \"bottom\")\nIn addition to using hired cars less often after the Pandemic, perhaps as a consequence of less business-related travel because of flexible work schedules, we see a second behavioral change in the post-Pandemic era, even if it is slight: for the class of trips we are observing, they run longer. Trips of one mile make up a smaller percentage of the total, while trips of more than three miles make up a larger percentage of the total since the onset of the Pandemic.\nBoth analyses suggest certainly abandoning pre-Pandemic data as well as all of the 2020 data. While the shift in typical distances smooths out already at the beginning of 2021, the number of trips does not reach its new normal until around October 2021, suggesting that is the true step into the post-Pandemic order.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Results</span>"
    ]
  },
  {
    "objectID": "results.html#patterns-across-hours-days-and-seasons",
    "href": "results.html#patterns-across-hours-days-and-seasons",
    "title": "3  Results",
    "section": "3.2 Patterns across Hours, Days, and Seasons",
    "text": "3.2 Patterns across Hours, Days, and Seasons\n\n\n\n\n[1] I. Lunden, “Juno shuts down its operations in NYC as owner Gett signs strategic partnership with Lyft.” Accessed: Nov. 27, 2024. [Online]. Available: https://techcrunch.com/2019/11/18/juno-shuts-down-its-operations-in-nyc-as-owner-gett-signs-strategic-partnership-with-lyft/\n\n\n[2] J. Fingas, “Via’s personal ride-hailing will shut down next week.” Accessed: Nov. 27, 2024. [Online]. Available: https://www.engadget.com/via-ride-hailing-service-shutdown-231321466.html",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Results</span>"
    ]
  }
]