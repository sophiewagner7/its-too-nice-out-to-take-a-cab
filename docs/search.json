[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "“It’s Too Nice Out to Take a Cab”: Weather and Taxi Usage in New York, 2019–2024",
    "section": "",
    "text": "1 Introduction\nAt first, Moacir was interested in seeing if there is a relationship between “unseasonably” warm weather and New York and drought like conditions, but Sophie suggested crossing in a dataset from a different domain and seeing what kinds of results could emerge. Instead of just looking at the weather, perhaps we can draw a relationship between human behavioral response to the weather. What might this look like? After a bit of discussion, we had a preliminary idea of testing the hypothesis that people use cabs less often when it is “nice” out in Manhattan. That is, they are more inclined to walk to their destination than hail an expensive cab.\nQuickly it was clear, however, that proving this hypothesis would require coming up with a definition of “nice,” so we flipped the project: we’re assuming as true that people are more inclined to walk when the weather is nice, so we are using the taxi data to see if we can define what “nice” weather is. Does it just mean sunny skies, or does it have a relationship to a temperature threshold? How might relative temperature come into play, such as an unusually warm day after a cold spell, impact people’s inclination to walk? And does the effect wear off if there are multiple nice days in a row, and the novelty of walking gives way to taking cabs again? These questions struck us as more amusing and speculative, so we decided to pursue them, instead.\nOverall, our project explores how weather influences the small, everyday decisions which collectively shape urban life. The unique spatial and temporal granularity of taxi data allows us to capture patterns of human mobility with precision. By doing so, we may observe behavioral shifts in response to weather changes in real time. Such a study not only provides a unique lens into how people adapt their transportation preferences due to the weather, but also serves as a microcosm for understanding human responses to environmental factors. Such insights are particularly relevant in a large, dynamic city like New York.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "data.html",
    "href": "data.html",
    "title": "2  Data",
    "section": "",
    "text": "2.1 Description\nWe are basing our analysis on two datasets, a dataset of taxi use in New York and historical weather data. For both datasets, we will limit our analysis to 2019-01-01 00:00:00 – 2024-06-25 23:00:00, in the interest of trying to catch about a year of pre-pandemic norms to help interpret pandemic and post-pandemic use of taxis. The taxi data only go to August, but the weather data only go through most of June this year.\nThe taxi data are provided by New York’s Taxi and Limousine Commission. They provide taxi data, in parquet format, going back to 2009. Since February of 2019, they have also included data on trips serviced by companies like Lyft and Uber, which are classified as “high-volume for-hire vehicle” (HVFHV) trips. The data are updated monthly, with a two-month lag. Our focus is on yellow taxi and HVFHV trips, because our focus is on intra-Manhattan trips. Only yellow cabs can pick up passengers in most of Manhattan, so we are ignoring green cabs and regular for-hire vehicles (town cars and limousines). Yellow cab data have 19 columns, and FHVHV data have 24 columns. With our Python scripts, we consolidate the data to create aggregated hourly statistics on trip duration, trip distance, fare amount, and tip amount.\nThe historical weather data are provided by the Global Historical Climate Network hourly (GHCNh), which provides hourly weather data going back over two centuries for New York City. The data come in annual parquet files for download by station. Our station, KNYC0, is listed in the GHCNh as USW00094728, and it is the weather station in Central Park. The data come in over 200 columns to account for the variability that can occur in the terse METAR report for airplanes, which is also included under remarks. The government provides a codebook to describe the remaining data. As we are interested in what conditions determine a “nice” day for not using a taxi, we want to keep as much data from the weather report as possible, including temperature, precipitation, sky cover, snow, humidity, and so on.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "data.html#missing-value-analysis",
    "href": "data.html#missing-value-analysis",
    "title": "2  Data",
    "section": "2.2 Missing value analysis",
    "text": "2.2 Missing value analysis\nThe taxi data are notoriously (as in, persistently) messy, registering trips outside the bounds of the time window and giving results that seem extremely unlikely, like large negative tips or negative trip durations. To counter these anomalies, we are limiting ourselves to trips between one minute and two hours long, and, when consolidating monthly data to yearly data, we filter out all results from other years. In the aggregate, however, the outliers generally wash out, as we have a record of over 500 million yellow cab and Uber/Lyft rides. Nevertheless, there is one data point where no trips are recorded: 2:00am on March 10, 2019. However, there are data on both sides, so we will interpolate results for this time. Who knows what happened to the taxi system that affected both Uber and yellow taxis. Additionally, the tip amounts for Uber/Lyft are almost certainly incorrect, as over 75% of rides report no tip at all. As such, we will drop the tip and fare amounts from our data to account for this. We had suspected that a higher tip percentage might be related to a nice day, even though we assume taxi usage is lower, but the data are simply unreliable.\nFor weather, we have a large array of missing values, but the remarks column is missing only 36 entries, for a general station uptime of 99.93%. Many of the columns have many more missing values, but that is because the way the weather data work is by reporting a NaN for the absence of data. For example, if there are no clouds in the sky, the sky cover values will be NaN, not something like “Clear.” That said, we have a consecutive period of 24 hours’ worth of missing data across May 31, 2023 to June 1, 2023. This includes missing remarks, suggesting the station was down. In our imagination, a peregrine falcon ate the station.\nThe other 12 missing remarks are scattered across the dataset.\nBecause we have a total of 48,072 points in time in our dataset, it is hard to see any of the missing data in any plot that includes the entire stretch.\n\n\nCode\nlibrary(ggplot2)\nlibrary(arrow)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(tidyr)\ndf &lt;- read_parquet(\"data/complete_weather_and_taxi_data.parquet\")\n\nheatmap_data &lt;- df |&gt;\n    mutate(week_start=lubridate::floor_date(date, unit=\"week\"),\n        week = lubridate::week(date),\n        year = lubridate::year(date)) |&gt;\n    group_by(year, week) |&gt;\n    summarize(n_missing=sum(is.na(temperature)))\n\nggplot(heatmap_data, aes(x = week, y = year, fill = n_missing)) +\n  geom_tile(color = \"white\") +\n  scale_fill_gradient(low = \"white\", high = \"red\", name = \"Missing Count\") +\n  scale_x_continuous(breaks = seq(1, 52, by = 4)) + \n  scale_y_continuous(breaks = seq(2019, 2024, by=1))+\n  labs(\n    title = \"Number of Missing Temperature Observations by Date\",\n    x = \"Week of Year\",\n    y = \"Year\"\n  ) +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n\n\n\n\n\n\n\n\nAs we can see in this chart, the missing temperature data (our most important metric, we suspect) are mostly centered in that 24-hour period when the station recorded no data. The other gaps are scattered across the data, with a tilt toward the older data. This is why we are confident in simply interpolating data for the missing values. Another option is to derive the temperature from the point in time’s METAR report, but we suspect the METAR reports for the missing data may be unparseable, in general.\n\n\nCode\nlibrary(redav)\ndf |&gt;\n  select(-c(pres_wx_AU3, snow_depth, pres_wx_AU2, sky_cover_2, wind_direction, sky_cover_3, pres_wx_AU1, wind_gust, juno, via)) |&gt;\n  plot_missing(percent=FALSE, max_rows=10, max_cols=10, num_char=6)\n\n\n\n\n\n\n\n\n\nOur second chart shows the distribution of missing data, but only after we have selected out the following columns:\n\n\n\n\n\n\n\nColumn\nExplanation\n\n\n\n\nsnow_depth\nAlmost always NaN, as it does not report 0 for no snow.\n\n\npres_wx_AU1\nAutomated present weather observation. Sometimes it gives none.\n\n\npres_wx_AU2\nThis is only filled if there is supplemental information for pres_wx_AU1.\n\n\npres_wx_AU3\nThis is only filled if there is supplemental information for pres_wx_AU2.\n\n\nsky_cover_2\nOnly records a second layer of clouds in the sky.\n\n\nsky_cover_3\nOnly records a third layer of clouds in the sky.\n\n\nwind_direction\nOnly records a direction if there is any wind.\n\n\nwind_gust\nOnly records gusts if there is any wind.\n\n\njuno\nJuno seems to have only operated for part of 2019.\n\n\nvia\nUse of Via completely cratered after early 2020.\n\n\n\nFrom the remaining data, we can see how infrequently a wind speed is registered and that the rest of the missing data are scattered in small numbers around the dataset, with almost all of the data making up complete cases (minus the above extracted columns).",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Data</span>"
    ]
  },
  {
    "objectID": "index.html#a-glance-at-the-data",
    "href": "index.html#a-glance-at-the-data",
    "title": "“It’s Too Nice Out to Take a Cab”: Weather and Taxi Usage in New York, 2019–2024",
    "section": "1.1 A glance at the data",
    "text": "1.1 A glance at the data\nLet’s take a quick peek at the data. Below we have weekly averages for daily temperature and taxi rides from January 2019 to June 2024.\n\n\nCode\nlibrary(ggplot2)\nlibrary(arrow)\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(tidyr)\ndf &lt;- read_parquet(\"data/complete_weather_and_taxi_data.parquet\")\ndf_day &lt;- df |&gt; \n    group_by(date) |&gt; \n    summarize(total_trips_day = sum(trip_count)) |&gt; \n    select(date, total_trips_day)\ndf_day |&gt; \n    mutate(week_start=lubridate::floor_date(date, unit=\"week\")) |&gt;\n    group_by(week_start) |&gt;\n    summarize(avg_trips_day = mean(total_trips_day))|&gt;\n    ggplot(aes(x=week_start, y=avg_trips_day)) +\n        geom_point(color=\"cornflowerblue\") +\n        geom_line(color=\"cornflowerblue\") + \n        scale_x_date(date_labels = \"%b %Y\", date_breaks = \"1 year\") +\n        scale_y_continuous(labels = comma) +\n        labs(title=\"Average daily taxi trips per week, January 2019 - June 2024\",\n             x = \"Date\", \n             y = \"Average number of trips in a day\") +\n        theme_classic()\n\n\n\n\n\n\n\n\n\nConsidering the taxi data, there are many narratives that can be told. The most notable observation on the chart is the dramatic decline in ridership in March 2020, coinciding with the beginning of the COVID-19 pandemic. While ridership has increased since, it has not nearly returned to pre-pandemic levels. This trend is likely influenced by the shift towards a more work-from-home friendly economic environment, along with other behavioral changes.\nWe can also observe seasonal fluctuations; for example, it appears that there are dips and peaks around January of each year. These could be attributed to behavioral changes around the holidays, including increased travel around the holidays, staying in on the holidays themselves, or different travel patterns due to the weather. We will have to look at this with a lot more granularity in order to parse out further trends in the data.\n\n\nCode\ndf_day &lt;- df |&gt; \n    filter(!is.na(temperature)) |&gt;\n    group_by(date) |&gt; \n    summarize(daily_temp = mean(temperature)) |&gt; \n    select(date, daily_temp)\ndf_day |&gt; \n    mutate(week_start=lubridate::floor_date(date, unit=\"week\")) |&gt;\n    group_by(week_start) |&gt;\n    summarize(avg_temp_day = mean(daily_temp)) |&gt;\n    ggplot(aes(x=week_start, y=avg_temp_day)) +\n        geom_point(color=\"cornflowerblue\") +\n        geom_line(color=\"cornflowerblue\") + \n        geom_hline(yintercept=0)+\n        scale_x_date(date_labels = \"%b %Y\", date_breaks = \"1 year\") +\n        labs(title=\"Average weekly temp, January 2019 - June 2024\",\n             x = \"Date\", \n             y = \"Tempurature (Celsius)\") +\n        theme_classic()\n\n\n\n\n\n\n\n\n\nAverage weekly temperature looks fairly consistent over time, with expected seasonal peaks and valleys across the year. There may be a subtle trend of slightly higher average temperatures in more recent years, but nothing too definitive.\nAs just one data point, temperature provides a limited slice into what may distinguish a “nice day.” In the next chapter, we will see that it will be necessary to calculate additional numeric and categorical weather measurements to help establish this definition. Ideas include change in temperature and a simple categorical variable for cloud cover derived from the multiple columns currently devoted to cloud cover.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  }
]